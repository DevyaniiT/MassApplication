@model MassApplication.Models.RoleWise_Class

<style>
    span.error {
        display: block;
        visibility: hidden;
        color: red;
        font-size: 90%;
    }

    /* table td.reportdataId, table td.dashboarddataId {
        display: none;
    }*/

    #tabContentRole .nav-link {
        color: #000;
        background-color: #e1e1e1;
        border: 0;
        margin: 0 4px;
        padding: 13px 23px;
        font-size: 13px;
        border-radius: 5px;
        text-transform: uppercase;
        font-weight: 600;
    }

        #tabContentRole .nav-link.active, .nav-tabs .nav-item.show .nav-link {
            color: #ffffff;
            background-color: #343a40;
            border: 0;
            padding: 13px 23px;
            margin: 0 4px;
            border-radius: 5px;
            text-transform: uppercase;
            font-size: 13px;
            font-weight: 600;
        }

    .btn-dash {
        background: #343a40;
        color: #fff;
        font-size: 14px;
        border-radius: 5px;
    }

        .btn-dash:hover {
            color: #fff;
        }
</style>

<div class="form-horizontal">
    <div class="master">

        <div class="form-group row">
            <div class="col-md-6">
                <div class="row">
                    <label ID="Lbl_rolename" class="col-sm-4 col-form-label" style="font-weight:500; font-size:14px">Role name </label>
                    <div class="col-sm-8">
                        <input id="role_name" type="text" class="form-control" placeholder="Enter role name ">
                        <span class="error">Role name required</span>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="row">
                    <label ID="Lbl_lastdes" class=" col-sm-4  col-form-label" style="font-weight:500; font-size:14px">Role Description</label>
                    <div class="col-sm-8">
                        <textarea id="role_description" class="form-control" placeholder="Enter description" rows="1"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <ul class="newnavconn nav nav-tabs border-bottom-0 mb-2" id="tabContentRole">
            <li class="nav-item"><a href="#newMenuTab" class="nav-link active" data-toggle="tab">Menu Details</a></li>
            <li class="nav-item"><a href="#newReportTab" class="nav-link" data-toggle="tab">Report Details</a></li>
            <li class="nav-item "><a href="#newDashboardTab" class="nav-link" data-toggle="tab">Dashboard Details</a></li>
            <li class="nav-item "><a href="#newKPITab" class="nav-link" data-toggle="tab">KPI Details</a></li>
            <li class="nav-item "><a href="#newQueryTab" class="nav-link" data-toggle="tab">Query Details</a></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane active" id="newMenuTab">
                <table id="menuLayout" class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th width="1%">ID</th>
                            <th width="40%">NAME</th>
                            <th width="15%" style="text-align:center">VIEW</th>
                            <th width="15%" style="text-align:center">ADD</th>
                            <th width="15%" style="text-align:center">UPDATE</th>
                            <th width="15%" style="text-align:center">DELETE</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var i in Model.menu_map_data)
                        {
                        <tr>
                            <td>@i.menu_id</td>
                            @{
                                var fontStyle = "normal";
                                if (i.menu_parent_id == "0")
                                {
                                    fontStyle = "bold";
                                }
                                <td class="menudataId" data-id="@i.menu_id" style="font-weight:@fontStyle">@i.menu_name</td>
                            }
                            <td style="text-align:center;">
                                <label class="switch">
                                    <input class="menu_view_mode" type="checkbox" data-id="@i.menu_id">
                                    <span class="slider round"></span>
                                </label>
                            </td>
                            <td style="text-align:center;">
                                <label class="switch">
                                    <input class="menu_add_mode" type="checkbox" data-id="@i.menu_id">
                                    <span class="slider round"></span>
                                </label>
                            </td>
                            <td style="text-align:center;">
                                <label class="switch">
                                    <input class="menu_update_mode" type="checkbox" data-id="@i.menu_id">
                                    <span class="slider round"></span>
                                </label>
                            </td>
                            <td style="text-align:center;">
                                <label class="switch">
                                    <input class="menu_delete_mode" type="checkbox" data-id="@i.menu_id">
                                    <span class="slider round"></span>
                                </label>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="tab-pane" id="newReportTab">
                <table id="rptLayout" class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th width="1%">ID</th>
                            <th width="40%">NAME</th>
                            <th width="20%">TYPE</th>
                            <th width="20%">CREATED BY</th>
                            <th width="15%" style="text-align:center">VIEW</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var i in Model.report_map_data)
                        {
                            <tr>
                                <td>@i.report_id</td>
                                <td class="reportdataId" data-id="@i.report_id">@i.report_name</td>
                                <td>@i.report_user_type</td>
                                <td>@i.report_created_by</td>
                                <td style="text-align:center;">
                                    <label class="switch">
                                        <input class="report_view_mode" type="checkbox" data-id="@i.report_id">
                                        <span class="slider round"></span>
                                    </label>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="tab-pane" id="newDashboardTab">
                <table id="dbLayout" class="table table-bordered table-hover" style="width:100% !important;">
                    <thead>
                        <tr>
                            <th width="1%">ID</th>
                            <th width="40%">NAME</th>
                            <th width="20%">TYPE</th>
                            <th width="20%">CREATED BY</th>
                            <th width="15%" style="text-align:center">VIEW</th>
                        </tr>

                    </thead>
                    <tbody>
                        @foreach (var m in Model.dashboard_map_data)
                        {
                            <tr>
                                <td>@m.dashboard_id</td>
                                <td class="dashboarddataId" data-id="@m.dashboard_id">@m.dashboard_name</td>
                                <td>@m.dashboard_user_type</td>
                                <td>@m.dashboard_created_by</td>
                                <td style="text-align:center;">
                                    <label class="switch">
                                        <input class="dashboard_view_mode" type="checkbox" data-id="@m.dashboard_id">
                                        <span class="slider round"></span>
                                    </label>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="tab-pane" id="newKPITab">
                <table id="kpiLayout" class="table table-bordered table-hover" style="width:100% !important;">
                    <thead>
                        <tr>
                            <th width="1%">ID</th>
                            <th width="40%">NAME</th>
                            <th width="20%">TYPE</th>
                            <th width="20%">CREATED BY</th>
                            <th width="15%" style="text-align:center">VIEW</th>
                        </tr>

                    </thead>
                    <tbody>
                        @foreach (var m in Model.kpi_map_data)
                        {
                            <tr>
                                <td>@m.kpi_id</td>
                                <td class="kpidataId" data-id="@m.kpi_id">@m.kpi_name</td>
                                <td>@m.kpi_user_type</td>
                                <td>@m.kpi_created_by</td>
                                <td style="text-align:center;">
                                    <label class="switch">
                                        <input class="kpi_view_mode" type="checkbox" data-id="@m.kpi_id">
                                        <span class="slider round"></span>
                                    </label>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="tab-pane" id="newQueryTab">
                <table id="queryLayout" class="table table-bordered table-hover" style="width:100% !important;">
                    <thead>
                        <tr>
                            <th width="1%">ID</th>
                            <th width="40%">NAME</th>
                            <th width="20%">TYPE</th>
                            <th width="20%">CREATED BY</th>
                            <th width="15%" style="text-align:center">VIEW</th>
                        </tr>

                    </thead>
                    <tbody>
                        @foreach (var m in Model.query_map_data)
                        {
                            <tr>
                                <td>@m.query_id</td>
                                <td class="querydataId" data-id="@m.query_id">@m.query_name</td>
                                <td>@m.query_user_type</td>
                                <td>@m.query_created_by</td>
                                <td style="text-align:center;">
                                    <label class="switch">
                                        <input class="query_view_mode" type="checkbox" data-id="@m.query_id">
                                        <span class="slider round"></span>
                                    </label>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div style="padding:10px 0; text-align:right">
        <button type="button" id="submitRoleDetail" class="btn btn-green pl-4 pr-4">Save</button>
        <button type="button" class="btn btn-dash pl-4 pr-4" data-dismiss="modal">Close</button>
    </div>
</div>

<!-- DATATABLE INITIALIZING FORMAT -->
<script>
    $(function () {
        $("#menuLayout").DataTable({
            'responsive': true,
            'info': false,
            'lengthChange': true,
            'autoWidth': false,
            'pageLength': 10,
            'paging': false,
            'scrollY': "300px",
            'scrollCollapse': true,
            dom: '<"float-left"><"float-right"f>rt<"row"<"col-sm-2"i><"col-sm-1 pt-2"l><"col-sm-9"p>>',
            'columnDefs': [{ 'visible': false, 'targets': [0] }]
            //language: {
            //    oPaginate: {
            //        sNext: '<i class="fa fa-forward"></i>',
            //        sPrevious: '<i class="fa fa-backward"></i>'

            //    },
            //    "info": "Showing page _PAGE_ of _PAGES_",
            //    "lengthMenu": "Rows :  _MENU_",
            //},
        });
        $("#rptLayout").DataTable({
            'responsive': true,
            'info': false,
            'lengthChange': true,
            'autoWidth': false,
            'pageLength': 10,
            'paging': false,
            'scrollY': "300px",
            'scrollCollapse': true,
            dom: '<"float-left"><"float-right"f>rt<"row"<"col-sm-2"i><"col-sm-1 pt-2"l><"col-sm-9"p>>',
            'columnDefs': [{ 'visible': false, 'targets': [0] }]
        });
        $("#dbLayout").DataTable({
            'responsive': true,
            'info': false,
            'lengthChange': true,
            'autoWidth': false,
            'pageLength': 10,
            'paging': false,
            'scrollY': "300px",
            'scrollCollapse': true,
            dom: '<"float-left"><"float-right"f>rt<"row"<"col-sm-2"i><"col-sm-1 pt-2"l><"col-sm-9"p>>',
            'columnDefs': [{ 'visible': false, 'targets': [0] }]
        });
        $("#kpiLayout").DataTable({
            'responsive': true,
            'info': false,
            'lengthChange': true,
            'autoWidth': false,
            'pageLength': 10,
            'paging': false,
            'scrollY': "300px",
            'scrollCollapse': true,
            dom: '<"float-left"><"float-right"f>rt<"row"<"col-sm-2"i><"col-sm-1 pt-2"l><"col-sm-9"p>>',
            'columnDefs': [{ 'visible': false, 'targets': [0] }]
        });
        $("#queryLayout").DataTable({
            'responsive': true,
            'info': false,
            'lengthChange': true,
            'autoWidth': false,
            'pageLength': 10,
            'paging': false,
            'scrollY': "300px",
            'scrollCollapse': true,
            dom: '<"float-left"><"float-right"f>rt<"row"<"col-sm-2"i><"col-sm-1 pt-2"l><"col-sm-9"p>>',
            'columnDefs': [{ 'visible': false, 'targets': [0] }]
        });
    });
</script>
<!-- SCRIPT FOR submitRoleDetail BUTTON -->
<script>
    $('#submitRoleDetail').click(function () {
        var isAllValid = true;
        if ($('#role_name').val().trim() == '') {
            $('#role_name').siblings('span.error').css('visibility', 'visible');
            isAllValid = false;
        }
        else {
            $('#role_name').siblings('span.error').css('visibility', 'hidden');
        }

        var menu_checkList = []
        var dashboard_checkList = []
        var report_checkList = []
        var kpi_checkList = []
        var query_checkList = []

        $('#menuLayout tbody>tr').each(function () {
            var menuItem = {
                menu_id: $('.menudataId', this).attr("data-id"),
                //report_id: $('#report_id', this).val(),
                role_menu_read: $('input[class="menu_view_mode"]', this).is(':checked'),
                role_menu_create: $('input[class="menu_add_mode"]', this).is(':checked'),
                role_menu_update: $('input[class="menu_update_mode"]', this).is(':checked'),
                role_menu_delete: $('input[class="menu_delete_mode"]', this).is(':checked')
            }
            menu_checkList.push(menuItem);
        });
        $('#dbLayout tbody>tr').each(function () {
            var dbItem = {
                dashboard_id: $('.dashboarddataId', this).attr("data-id"),
                //dashboard_id: $('#dashboard_id', this).val(),
                role_dashboard_read: $('input[class="dashboard_view_mode"]', this).is(':checked')
                //role_dashboard_create: $('input[class="dashboard_add_mode"]', this).is(':checked'),
                //role_dashboard_update: $('input[class="dashboard_update_mode"]', this).is(':checked'),
                //role_dashboard_delete: $('input[class="dashboard_delete_mode"]', this).is(':checked')
            }
            dashboard_checkList.push(dbItem);
        });
        $('#rptLayout tbody>tr').each(function () {
            var rptItem = {
                report_id: $('.reportdataId', this).attr("data-id"),
                //report_id: $('#report_id', this).val(),
                role_report_read: $('input[class="report_view_mode"]', this).is(':checked')
                //role_report_create: $('input[class="report_add_mode"]', this).is(':checked'),
                //role_report_update: $('input[class="report_update_mode"]', this).is(':checked'),
                //role_report_delete: $('input[class="report_delete_mode"]', this).is(':checked')
            }
            report_checkList.push(rptItem);
        });
        $('#kpiLayout tbody>tr').each(function () {
            var kpiItem = {
                kpi_id: $('.kpidataId', this).attr("data-id"),
                //kpi_id: $('#kpi_id', this).val(),
                role_kpi_read: $('input[class="kpi_view_mode"]', this).is(':checked')
                //role_kpi_create: $('input[class="kpi_add_mode"]', this).is(':checked'),
                //role_kpi_update: $('input[class="kpi_update_mode"]', this).is(':checked'),
                //role_kpi_delete: $('input[class="kpi_delete_mode"]', this).is(':checked')
            }
            kpi_checkList.push(kpiItem);
        });
        $('#queryLayout tbody>tr').each(function () {
            var queryItem = {
                query_id: $('.querydataId', this).attr("data-id"),
                //query_id: $('#query_id', this).val(),
                role_query_read: $('input[class="query_view_mode"]', this).is(':checked')
                //role_query_create: $('input[class="query_add_mode"]', this).is(':checked'),
                //role_query_update: $('input[class="query_update_mode"]', this).is(':checked'),
                //role_query_delete: $('input[class="query_delete_mode"]', this).is(':checked')
            }
            query_checkList.push(queryItem);
        });

        //console.log("dashboard_checkList:", dashboard_checkList);
        //console.log("report_checkList:", report_checkList);
        //console.log("menu_checkList:", menu_checkList);
        //console.log("query_checkList:", query_checkList);
        //console.log("kpi_checkList:", kpi_checkList);

        if (isAllValid) {
            var data = {
                role_name: $('#role_name').val().trim(),
                role_description: $('#role_description').val().trim(),
                dashboard_map_data: dashboard_checkList,
                report_map_data: report_checkList,
                menu_map_data: menu_checkList,
                kpi_map_data: kpi_checkList,
                query_map_data: query_checkList
            }
            console.log("data:", data);
           $.ajax({
                type: 'POST',
                url: '@Url.Content("~/User/AddNewRoleData")',
                data: JSON.stringify(data),
                contentType: 'application/json',
                 success: function (data) {
                  if (data.startsWith("ERROR")) {
                      var res = data.split(";");
                      var error = '';
                      if (res.length > 1) {
                          error = res[1];
                      }
                      else {
                          error = data;
                      }
                      alert(error);
                  } else {
                      alert('Data inserted successfully!!!');
                      location.reload();
                  }
            },
                 error: function (error) {
                    alert("Error");
                }
            });
        }
    });
</script>


